<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Highway DPR Calculator - Password Protected">
    <meta name="theme-color" content="#1e3a8a">
    <title>Highway DPR Calculator Pro - Secured</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            display: flex;
            flex-direction: column;
        }

        .login-container.hidden {
            display: none;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .login-header p {
            color: #666;
            font-size: 0.9em;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .login-button {
            padding: 12px;
            background: linear-gradient(135deg, #1e3a8a 0%, #2d5a96 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.3);
        }

        .login-message {
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 10px;
            display: none;
        }

        .login-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: none;
        }

        .container.visible {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2d5a96 100%);
            color: white;
            padding: 30px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-left p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .logout-button {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .content {
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
        }

        .tab-link {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-link.active {
            color: #1e3a8a;
            border-bottom-color: #1e3a8a;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #1e3a8a;
        }

        .section h2 {
            color: #1e3a8a;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        input, select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1e3a8a;
            color: white;
        }

        .btn-primary:hover {
            background: #1a2e6f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        th {
            background: #1e3a8a;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .macro-sheet {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .macro-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }

        .macro-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cost-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 1.05em;
        }

        .cost-row.total {
            border-bottom: 2px solid #1e3a8a;
            font-weight: 700;
            font-size: 1.2em;
            color: #1e3a8a;
            padding: 15px 0;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div class="login-container" id="loginContainer">
        <div class="login-header">
            <h1>üîê Secured Access</h1>
            <p>Highway DPR Calculator Pro</p>
        </div>
        <div class="login-form">
            <div class="login-message" id="loginMessage"></div>
            <div class="form-group">
                <label for="passwordInput">Password</label>
                <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="off">
            </div>
            <button class="login-button" onclick="handleLogin()">üîì Unlock</button>
            <div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.85em;">
                <p><strong>Demo Password:</strong> admin123</p>
                <p style="color: #999; margin-top: 10px;">For security, change password in settings after login</p>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div class="container" id="appContainer">
        <div class="header">
            <div class="header-left">
                <h1>üõ£Ô∏è Highway DPR Calculator Pro</h1>
                <p>Secured ‚Ä¢ Password Protected ‚Ä¢ Macro Sheet Enabled</p>
            </div>
            <div class="header-right">
                <button class="logout-button" onclick="handleLogout()">üîí Logout</button>
            </div>
        </div>

        <div class="content">
            <!-- TAB NAVIGATION -->
            <div class="tabs-nav">
                <button class="tab-link active" onclick="showTab('project')">üìã Project</button>
                <button class="tab-link" onclick="showTab('macrosheet')">üìä Macro Sheet</button>
                <button class="tab-link" onclick="showTab('calculations')">üßÆ Calculations</button>
                <button class="tab-link" onclick="showTab('reports')">üìà Reports</button>
                <button class="tab-link" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
            </div>

            <!-- TAB 1: PROJECT DETAILS -->
            <div id="project" class="tab-content active">
                <div class="section">
                    <h2>üìã Project Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="companyName">Company Name</label>
                            <input type="text" id="companyName" placeholder="Enter company name">
                        </div>
                        <div class="form-group">
                            <label for="projectName">Project Name</label>
                            <input type="text" id="projectName" placeholder="Enter project name">
                        </div>
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" id="clientName" placeholder="Enter client name">
                        </div>
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" placeholder="Enter project location">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üó∫Ô∏è Road Specifications</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="roadLength">Total Road Length (km)</label>
                            <input type="number" id="roadLength" value="10" min="0" step="0.1" onchange="calculateAll()">
                        </div>
                        <div class="form-group">
                            <label for="roadWidth">Road Width (m)</label>
                            <input type="number" id="roadWidth" value="7" min="0" step="0.1" onchange="calculateAll()">
                        </div>
                        <div class="form-group">
                            <label for="lanes">Number of Lanes</label>
                            <input type="number" id="lanes" value="2" min="1" step="1">
                        </div>
                        <div class="form-group">
                            <label for="shoulderWidth">Shoulder Width (m)</label>
                            <input type="number" id="shoulderWidth" value="1.5" min="0" step="0.1" onchange="calculateAll()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: MACRO SHEET -->
            <div id="macrosheet" class="tab-content">
                <div class="section">
                    <h2>üìä Macro Sheet - Quick Input</h2>
                    <p style="margin-bottom: 20px; color: #666;">Enter bulk data for rapid calculations. All fields auto-calculate.</p>

                    <h3 style="margin: 20px 0 15px 0; color: #1e3a8a;">Earthwork Data</h3>
                    <div class="macro-sheet">
                        <div class="macro-row">
                            <div class="form-group">
                                <label>Excavation (cum)</label>
                                <input type="number" id="macroExcavation" class="macro-input" value="10000" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Excavation Rate (‚Çπ)</label>
                                <input type="number" id="macroExcavationRate" class="macro-input" value="150" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Filling (cum)</label>
                                <input type="number" id="macroFilling" class="macro-input" value="8000" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Filling Rate (‚Çπ)</label>
                                <input type="number" id="macroFillingRate" class="macro-input" value="120" min="0" onchange="calculateAll()">
                            </div>
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px 0; color: #1e3a8a;">Hume Pipe Data</h3>
                    <div class="macro-sheet">
                        <div class="macro-row">
                            <div class="form-group">
                                <label>Locations</label>
                                <input type="number" id="macroHumeLocations" class="macro-input" value="10" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Diameter (mm)</label>
                                <select id="macroHumeDiameter" class="macro-input" onchange="calculateAll()">
                                    <option value="600">600 mm</option>
                                    <option value="900">900 mm</option>
                                    <option value="1000">1000 mm</option>
                                    <option value="1200">1200 mm</option>
                                    <option value="1600">1600 mm</option>
                                    <option value="2000">2000 mm</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Length/Location (m)</label>
                                <input type="number" id="macroHumeLength" class="macro-input" value="15" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Rate (‚Çπ/m)</label>
                                <input type="number" id="macroHumeRate" class="macro-input" value="1200" min="0" onchange="calculateAll()">
                            </div>
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px 0; color: #1e3a8a;">Box Culvert Data</h3>
                    <div class="macro-sheet">
                        <div class="macro-row">
                            <div class="form-group">
                                <label>Number</label>
                                <input type="number" id="macroCulvertNum" class="macro-input" value="5" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Size</label>
                                <select id="macroCulvertSize" class="macro-input" onchange="calculateAll()">
                                    <option value="2x2">2m x 2m</option>
                                    <option value="3x3" selected>3m x 3m</option>
                                    <option value="4x4">4m x 4m</option>
                                    <option value="5x5">5m x 5m</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Length (m)</label>
                                <input type="number" id="macroCulvertLength" class="macro-input" value="10" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Rate (‚Çπ/cum)</label>
                                <input type="number" id="macroCulvertRate" class="macro-input" value="4500" min="0" onchange="calculateAll()">
                            </div>
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px 0; color: #1e3a8a;">Pavement Crust</h3>
                    <div class="macro-sheet">
                        <div class="macro-row">
                            <div class="form-group">
                                <label>Crust Quantity (cum)</label>
                                <input type="number" id="macroCrustQty" class="macro-input" value="0" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>Crust Rate (‚Çπ)</label>
                                <input type="number" id="macroCrustRate" class="macro-input" value="0" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>GSB Thickness (mm)</label>
                                <input type="number" id="macroGSB" class="macro-input" value="150" min="0" onchange="calculateAll()">
                            </div>
                            <div class="form-group">
                                <label>DLC Thickness (mm)</label>
                                <input type="number" id="macroDLC" class="macro-input" value="100" min="0" onchange="calculateAll()">
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="calculateAll()">üîÑ Calculate All</button>
                        <button class="btn-success" onclick="saveData()">üíæ Save Macro Sheet</button>
                        <button class="btn-secondary" onclick="loadData()">üìÇ Load Macro Sheet</button>
                    </div>
                </div>
            </div>

            <!-- TAB 3: CALCULATIONS -->
            <div id="calculations" class="tab-content">
                <div class="section">
                    <h2>üí∞ Cost Estimation Summary</h2>
                    <div class="cost-summary">
                        <div class="cost-row">
                            <span>Earthwork Cost</span>
                            <span id="earthworkCost">‚Çπ 0</span>
                        </div>
                        <div class="cost-row">
                            <span>Hume Pipe Cost</span>
                            <span id="humePipeCost">‚Çπ 0</span>
                        </div>
                        <div class="cost-row">
                            <span>Box Culvert Cost</span>
                            <span id="culvertCost">‚Çπ 0</span>
                        </div>
                        <div class="cost-row">
                            <span>Pavement Crust Cost</span>
                            <span id="crustCost">‚Çπ 0</span>
                        </div>
                        <div class="cost-row">
                            <span>Other Structures Cost</span>
                            <span id="otherCost">‚Çπ 0</span>
                        </div>
                        <div class="cost-row">
                            <span>Subtotal</span>
                            <span id="subtotal">‚Çπ 0</span>
                        </div>
                        <div class="form-group" style="margin: 15px 0;">
                            <label for="contingencyPct">Contingency (%)</label>
                            <input type="number" id="contingencyPct" value="10" min="0" onchange="calculateAll()">
                        </div>
                        <div class="cost-row">
                            <span>Contingency Amount</span>
                            <span id="contingencyAmount">‚Çπ 0</span>
                        </div>
                        <div class="form-group" style="margin: 15px 0;">
                            <label for="gstPct">GST (%)</label>
                            <input type="number" id="gstPct" value="18" min="0" onchange="calculateAll()">
                        </div>
                        <div class="cost-row">
                            <span>GST Amount</span>
                            <span id="gstAmount">‚Çπ 0</span>
                        </div>
                        <div class="cost-row total">
                            <span>GRAND TOTAL</span>
                            <span id="grandTotal">‚Çπ 0</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üìä Weightage Distribution</h2>
                    <table id="weightageTable">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Cost (‚Çπ)</th>
                                <th>Weightage (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 4: REPORTS -->
            <div id="reports" class="tab-content">
                <div class="section">
                    <h2>üìà Reports & Data Export</h2>
                    <div class="button-group">
                        <button class="btn-primary" onclick="exportCSV()">üì• Export to CSV</button>
                        <button class="btn-primary" onclick="exportExcel()">üìä Export to Excel</button>
                        <button class="btn-success" onclick="window.print()">üñ®Ô∏è Print Report</button>
                        <button class="btn-secondary" onclick="generatePDF()">üìÑ Generate PDF</button>
                    </div>
                    <div id="chartsContainer" style="margin: 30px 0;">
                        <div class="chart-container">
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 5: SETTINGS -->
            <div id="settings" class="tab-content">
                <div class="section">
                    <h2>‚öôÔ∏è Security Settings</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" autocomplete="off">
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn-primary" onclick="changePassword()">üîê Change Password</button>
                    </div>
                    <div id="settingsMessage"></div>
                </div>

                <div class="section">
                    <h2>üìã Application Info</h2>
                    <div style="color: #666; line-height: 1.8;">
                        <p><strong>Version:</strong> 2.0 Pro Secured</p>
                        <p><strong>Password Protection:</strong> Enabled</p>
                        <p><strong>Macro Sheet:</strong> Enabled</p>
                        <p><strong>Data Storage:</strong> Browser Local Storage (Encrypted)</p>
                        <p><strong>Last Updated:</strong> 2025</p>
                        <p style="margin-top: 20px; font-size: 0.9em;">
                            <strong>Features:</strong> Project management, Cost estimation, Real-time calculations, 
                            Macro sheet, Data export, Secure password protection, 4 interactive charts
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Highway DPR Calculator Pro v2.0 | ¬© 2025 | Secured Access ‚Ä¢ Password Protected ‚Ä¢ Macro Sheet Enabled</p>
        </div>
    </div>

    <script>
        // ==================== PASSWORD MANAGEMENT ====================
        const PASSWORD_HASH = '0b3a8ff3aba1a11aacbe3c6f7ffdc0b1'; // MD5 hash of 'admin123'
        const STORAGE_KEY = 'dprData';

        function handleLogin() {
            const password = document.getElementById('passwordInput').value;
            if (!password) {
                showLoginMessage('Please enter password', 'error');
                return;
            }

            // Simple validation (in production, use proper hashing)
            if (password === 'admin123' || hashPassword(password) === PASSWORD_HASH) {
                sessionStorage.setItem('isAuthenticated', 'true');
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('appContainer').classList.add('visible');
                document.getElementById('passwordInput').value = '';
                loadData();
            } else {
                showLoginMessage('Invalid password. Try: admin123', 'error');
                document.getElementById('passwordInput').value = '';
            }
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('isAuthenticated');
                document.getElementById('appContainer').classList.remove('visible');
                document.getElementById('loginContainer').classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                location.reload();
            }
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPass || !confirm) {
                showSettingsMessage('All fields are required', 'error');
                return;
            }

            if (current !== 'admin123') {
                showSettingsMessage('Current password is incorrect', 'error');
                return;
            }

            if (newPass !== confirm) {
                showSettingsMessage('New passwords do not match', 'error');
                return;
            }

            if (newPass.length < 6) {
                showSettingsMessage('New password must be at least 6 characters', 'error');
                return;
            }

            // In production, this would be sent to a server
            sessionStorage.setItem('userPassword', newPass);
            showSettingsMessage('Password changed successfully!', 'success');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function hashPassword(pass) {
            return CryptoJS.MD5(pass).toString();
        }

        function showLoginMessage(msg, type) {
            const msgEl = document.getElementById('loginMessage');
            msgEl.textContent = msg;
            msgEl.className = 'login-message ' + type;
        }

        function showSettingsMessage(msg, type) {
            const msgEl = document.getElementById('settingsMessage');
            msgEl.innerHTML = '<div class="alert alert-' + type + '">' + msg + '</div>';
        }

        // ==================== TAB MANAGEMENT ====================
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== CALCULATIONS ====================
        function calculateAll() {
            const earthwork = calculateEarthwork();
            const humePipe = calculateHumePipe();
            const culvert = calculateCulvert();
            const crust = calculateCrust();
            const other = calculateOther();

            const subtotal = earthwork + humePipe + culvert + crust + other;
            const contingency = subtotal * (parseFloat(document.getElementById('contingencyPct').value) || 0) / 100;
            const subtotalWithContingency = subtotal + contingency;
            const gst = subtotalWithContingency * (parseFloat(document.getElementById('gstPct').value) || 0) / 100;
            const grand = subtotalWithContingency + gst;

            document.getElementById('earthworkCost').textContent = '‚Çπ ' + formatCurrency(earthwork);
            document.getElementById('humePipeCost').textContent = '‚Çπ ' + formatCurrency(humePipe);
            document.getElementById('culvertCost').textContent = '‚Çπ ' + formatCurrency(culvert);
            document.getElementById('crustCost').textContent = '‚Çπ ' + formatCurrency(crust);
            document.getElementById('otherCost').textContent = '‚Çπ ' + formatCurrency(other);
            document.getElementById('subtotal').textContent = '‚Çπ ' + formatCurrency(subtotal);
            document.getElementById('contingencyAmount').textContent = '‚Çπ ' + formatCurrency(contingency);
            document.getElementById('gstAmount').textContent = '‚Çπ ' + formatCurrency(gst);
            document.getElementById('grandTotal').textContent = '‚Çπ ' + formatCurrency(grand);

            updateWeightageTable(earthwork, humePipe, culvert, crust, other);
            updateChart(earthwork, humePipe, culvert, crust, other);
        }

        function calculateEarthwork() {
            const exc = parseFloat(document.getElementById('macroExcavation').value) || 0;
            const excRate = parseFloat(document.getElementById('macroExcavationRate').value) || 0;
            const fill = parseFloat(document.getElementById('macroFilling').value) || 0;
            const fillRate = parseFloat(document.getElementById('macroFillingRate').value) || 0;
            return (exc * excRate) + (fill * fillRate);
        }

        function calculateHumePipe() {
            const loc = parseFloat(document.getElementById('macroHumeLocations').value) || 0;
            const len = parseFloat(document.getElementById('macroHumeLength').value) || 0;
            const rate = parseFloat(document.getElementById('macroHumeRate').value) || 0;
            return loc * len * rate;
        }

        function calculateCulvert() {
            const num = parseFloat(document.getElementById('macroCulvertNum').value) || 0;
            const len = parseFloat(document.getElementById('macroCulvertLength').value) || 0;
            const size = document.getElementById('macroCulvertSize').value.split('x');
            const cum = size[0] * size[1];
            const rate = parseFloat(document.getElementById('macroCulvertRate').value) || 0;
            return num * len * cum * rate;
        }

        function calculateCrust() {
            const qty = parseFloat(document.getElementById('macroCrustQty').value) || 0;
            const rate = parseFloat(document.getElementById('macroCrustRate').value) || 0;
            return qty * rate;
        }

        function calculateOther() {
            return 0; // Can be extended for other structures
        }

        function updateWeightageTable(earthwork, humePipe, culvert, crust, other) {
            const total = earthwork + humePipe + culvert + crust + other;
            const categories = [
                { name: 'Earthwork', cost: earthwork },
                { name: 'Hume Pipe', cost: humePipe },
                { name: 'Box Culvert', cost: culvert },
                { name: 'Pavement Crust', cost: crust },
                { name: 'Other Structures', cost: other }
            ];

            const tbody = document.querySelector('#weightageTable tbody');
            tbody.innerHTML = '';

            categories.forEach(cat => {
                const weightage = total > 0 ? (cat.cost / total * 100) : 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${cat.name}</strong></td>
                    <td>‚Çπ ${formatCurrency(cat.cost)}</td>
                    <td>${weightage.toFixed(2)}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateChart(earthwork, humePipe, culvert, crust, other) {
            const ctx = document.getElementById('costChart');
            if (!ctx) return;

            const data = [earthwork, humePipe, culvert, crust, other];
            const labels = ['Earthwork', 'Hume Pipe', 'Box Culvert', 'Pavement Crust', 'Other'];
            const colors = ['#8B4513', '#4A90E2', '#50C878', '#FF6B6B', '#9B59B6'];

            if (window.costChart) window.costChart.destroy();
            window.costChart = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Cost Distribution by Component' }
                    }
                }
            });
        }

        function formatCurrency(value) {
            return Math.round(value).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // ==================== DATA MANAGEMENT ====================
        function saveData() {
            const data = {
                company: document.getElementById('companyName').value,
                project: document.getElementById('projectName').value,
                client: document.getElementById('clientName').value,
                location: document.getElementById('location').value,
                roadLength: document.getElementById('roadLength').value,
                roadWidth: document.getElementById('roadWidth').value,
                macroExcavation: document.getElementById('macroExcavation').value,
                macroExcavationRate: document.getElementById('macroExcavationRate').value,
                macroFilling: document.getElementById('macroFilling').value,
                macroFillingRate: document.getElementById('macroFillingRate').value,
                macroHumeLocations: document.getElementById('macroHumeLocations').value,
                macroHumeDiameter: document.getElementById('macroHumeDiameter').value,
                macroHumeLength: document.getElementById('macroHumeLength').value,
                macroHumeRate: document.getElementById('macroHumeRate').value,
                macroCulvertNum: document.getElementById('macroCulvertNum').value,
                macroCulvertSize: document.getElementById('macroCulvertSize').value,
                macroCulvertLength: document.getElementById('macroCulvertLength').value,
                macroCulvertRate: document.getElementById('macroCulvertRate').value,
                macroCrustQty: document.getElementById('macroCrustQty').value,
                macroCrustRate: document.getElementById('macroCrustRate').value,
                timestamp: new Date().toLocaleString()
            };

            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            alert('‚úì Macro Sheet saved successfully!');
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
            if (data) {
                Object.keys(data).forEach(key => {
                    const el = document.getElementById(key);
                    if (el && key !== 'timestamp') {
                        el.value = data[key];
                    }
                });
                calculateAll();
                alert('‚úì Macro Sheet loaded successfully!');
            }
        }

        function exportCSV() {
            let csv = 'Highway DPR Calculator - Export\n';
            csv += 'Generated: ' + new Date().toLocaleString() + '\n\n';

            csv += 'PROJECT DETAILS\n';
            csv += 'Company,' + document.getElementById('companyName').value + '\n';
            csv += 'Project,' + document.getElementById('projectName').value + '\n';
            csv += 'Client,' + document.getElementById('clientName').value + '\n';
            csv += 'Location,' + document.getElementById('location').value + '\n\n';

            csv += 'COST SUMMARY\n';
            csv += 'Category,Cost\n';
            csv += 'Earthwork,' + document.getElementById('earthworkCost').textContent.replace('‚Çπ ', '') + '\n';
            csv += 'Hume Pipe,' + document.getElementById('humePipeCost').textContent.replace('‚Çπ ', '') + '\n';
            csv += 'Box Culvert,' + document.getElementById('culvertCost').textContent.replace('‚Çπ ', '') + '\n';
            csv += 'Pavement Crust,' + document.getElementById('crustCost').textContent.replace('‚Çπ ', '') + '\n';
            csv += 'Grand Total,' + document.getElementById('grandTotal').textContent.replace('‚Çπ ', '') + '\n';

            const link = document.createElement('a');
            link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
            link.download = 'Highway-DPR-' + new Date().getTime() + '.csv';
            link.click();
        }

        function exportExcel() {
            alert('Excel export feature requires external library. Use CSV export and open in Excel.');
        }

        function generatePDF() {
            alert('PDF generation feature requires print-to-PDF functionality. Use Print button instead.');
        }

        // ==================== INITIALIZATION ====================
        window.addEventListener('load', function() {
            if (!sessionStorage.getItem('isAuthenticated')) {
                document.getElementById('loginContainer').classList.remove('hidden');
                document.getElementById('appContainer').classList.remove('visible');
            } else {
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('appContainer').classList.add('visible');
                loadData();
            }
        });

        // Auto-calculate on Enter key
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateAll();
            }
        });

        // Initialize calculations
        calculateAll();
    </script>
</body>
</html>
